---
name: iterative-retrieval
description: "迭代检索 — 4 阶段循环（DISPATCH→EVALUATE→REFINE→LOOP）精确定位代码库中的相关信息。最多 3 轮。"
---

# Iterative Retrieval

## 概述

在大型代码库中，一次搜索往往不够。此 skill 通过迭代检索循环，逐步缩小范围，精确定位相关代码。

## 4 阶段循环

### 1. DISPATCH（分发搜索）

- 从需求中提取搜索关键词
- 选择搜索策略：
  - Glob：按文件名模式搜索
  - Grep：按内容关键词搜索
  - AST：按代码结构搜索（函数名、类名）
- 并行发起多个搜索

### 2. EVALUATE（评估结果）

对每个搜索结果评分（0-1）：

| 分数 | 含义 | 动作 |
|------|------|------|
| 0.8-1.0 | 高度相关 | 保留，深入阅读 |
| 0.5-0.7 | 部分相关 | 保留，提取关键信息 |
| 0.2-0.4 | 低相关 | 记录路径，不深入 |
| 0.0-0.1 | 不相关 | 丢弃 |

### 3. REFINE（精炼查询）

根据评估结果调整搜索策略：
- 高相关结果 → 在同目录/同模块中扩展搜索
- 低相关结果 → 更换关键词或搜索策略
- 发现新线索 → 追加搜索

### 4. LOOP（循环判断）

- 已找到足够信息 → 结束，输出摘要
- 信息不足且轮次 < 3 → 回到 DISPATCH
- 已达 3 轮 → 强制结束，输出已有信息 + 未解决问题

## 终止条件

- 所有关键问题已有答案
- 高相关结果覆盖了需求的所有方面
- 达到最大轮次（3 轮）

## 输出格式

```text
## 检索报告

### 轮次：N/3

### 发现
| 文件 | 相关度 | 关键信息 |
|------|--------|----------|
| ...  | 0.9    | ...      |

### 未解决
- <仍需确认的问题>

### 搜索历史
1. <查询> → <结果数> 条，最高相关度 <score>
```

## VibeGuard 集成

- 搜索结果中标注已有实现（支持 L1 先搜后写）
- 发现重复代码时标记（支持反重复检查）
