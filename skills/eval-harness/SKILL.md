---
name: eval-harness
description: "评估驱动开发 — 用 pass@k / pass^k 指标量化代码生成质量，通过 Grader 自动评分。"
---

# Eval Harness

## 概述

评估驱动开发：不只是"代码能跑"，而是量化"代码有多好"。

## 核心指标

### pass@k（单次成功率）

- 生成 k 个候选方案，至少 1 个通过的概率
- 用于评估单个任务的完成质量
- 目标：pass@1 > 80%

### pass^k（连续成功率）

- 连续 k 个任务全部一次通过的概率
- 用于评估整体工作流的可靠性
- 目标：pass^5 > 50%（连续 5 个任务全部一次通过）

## Grader 类型

### 代码基础 Grader（确定性）

| Grader | 检查内容 | 通过条件 |
|--------|----------|----------|
| 编译检查 | 代码能否编译/类型检查通过 | 零错误 |
| 测试检查 | 测试是否全部通过 | 全绿 |
| Lint 检查 | 代码风格是否符合规范 | 零警告（或仅允许的警告） |
| 覆盖率检查 | 测试覆盖率是否达标 | ≥ 80% |

### 模型基础 Grader（概率性）

| Grader | 检查内容 | 评分方式 |
|--------|----------|----------|
| 代码审查 | 代码质量、可读性、安全性 | 0-10 分 |
| 需求匹配 | 实现是否满足需求 | 0-1 匹配度 |
| 架构评估 | 设计是否合理 | 0-10 分 |

## 使用流程

1. **定义评估标准**
   - 从需求提取可验证的通过条件
   - 选择合适的 Grader 组合

2. **运行评估**
   - 代码基础 Grader 先行（快速、确定性）
   - 模型基础 Grader 补充（深度、概率性）

3. **分析结果**
   - pass@1 < 80% → 需求不清晰或实现策略有问题
   - pass^5 < 50% → 工作流有系统性问题

4. **改进**
   - 根据失败模式调整策略
   - 更新 Grader 规则

## VibeGuard 集成

- 代码基础 Grader 可复用 `guard_check` 的输出
- 安全 Grader 参考 `rules/security.md`
- 质量 Grader 参考 `rules/universal.md`
